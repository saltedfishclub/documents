# 代码贡献规范


## 说明

若项目无特指无需遵守代码贡献规范或制定了独立的规则，则使用本文档所述规范。  
本文档是建议性的，但这并不意味着您可以忽略所有内容。  

# 交流

详见[代码条款](CODE_OF_CONDUCT.md)

# 提交代码

我们常常需要提交代码，但不规范的提交可能会带来审阅和维护上的困难。  
因此，出于项目可维护性的目的，我们建议您做到以下几点：

1. 我们不强求代码风格的统一，但代码应当简洁易懂。（通过适当的注释和解耦可以很轻松的做到这一点）  
2. 非必要，不引入新的依赖。（主要是对于其他贡献者）
3. 规范的提交信息以及提交尺寸。（一小件事情一个 Commit ，一大件事情一个 PR）  
  * 对于新增功能，应该开一个新的分支和一个 Pull Request，并在标题前打上 `[WIP]`。
  * 这样做的好处是，Maintainer 可以一点一点审阅你的提交（尤其是大的模块），而且小的 commit 解决起冲突也比较容易。
  * 同时，这也有助于代码的回滚操作。

4. 不要擅自更改版本号
5. 开 PR 时，如果和某个 issue 有关联请考虑命名 `issue-xx`
6. 合并 PR 时请使用 `Squash and Merge`，这有助于使 commit 历史记录简洁明了。
7. 合并 PR 前**必须等待所有 workdlow 运行完毕**，同时 Maintainer 的所有问题都应该被解决。

## 提交信息规范

好的提交信息规范应当在第一行就说明了他主要干了什么（因为 GitHub 默认也只显示第一行）。描述一个动作可以由两部分组成：

 1. 动作: 修复(fix)，重构(refactor \[这是个动词，不是名词\])，添加(add)，删除(remove/del)。总是使用一般现在时  
 2. 操作对象：某个模块，某段代码，一些 class，某个文档
 
 比如这样:
 ```
 Remove a typo in document.
 ```
 
 或者这样：
 ```
 [Refactor](BootStrap Module) resource loading in init phase.
 ```

接着下面可以写更多行来具体描述你干了什么，或者是别的顺带牵扯到的东西，比如某些魔法问题的参考解决方案来源，或者什么不适合放在注释里的东西。  
如果你只提交了一小部分，然而又不想开个 PR，你也可以加一个 \[WIP\] 表示还没完工。

## 代码规范

对于不同的语言有不同的范式，在编写的时候也不要过分的在意性能。

1. Java

对于 Java ，我们倾向于*学习*(而不是全部照搬) [Google 的代码规范](https://github.com/fantasticmao/google-java-style-guide-zh_cn)  
除此之外，处于建议性的目的，我们还推荐您（但不强求）:

 - 在恰当的时机使用 `java.util.Optional` —— 这相当于一个`受检异常`，同时可以为调用者提供流式处理`空`情况的 API  
 当然，该用 null 还是要用 null。有时候直接处理 null 会比 Optional 更好用，应该出于简易性选择
 
 - 巧妙的使用 Lombok 和使用高版本的 Java 语言特性。这可以减少很多样版代码。    
 - 适当的命名有助于代码的理解，而且要避免歧义或者别的语义问题。尤其是 Lambda 参数名和过程代码。
 - 提交前进行 Lint，在兼顾可读性的情况下代码尽可能精简化以助于性能优化。
 - 对于 Stream 中比较大的 Lambda 函数体请拆成一个静态方法。这有助于代码的维护和阅读
 - 避免过多反射。反射代码通常不易读，因此非必要请不要使用反射，若有必要请添加注释。
 - 遵循 PECS 原则（生产者使用`? extends T`，消费者使用`? super T` ）
 - 请注意对象的生命周期。如果不关注这个问题可能会引起内存泄漏，可以适当使用弱引用容器来解决。
 - 准循单一职责原则。如果你发现你的类需要维护太多的状态请考虑拆分成不同的部分。

# End
